
<!DOCTYPE html>
<html>
<head>
    <title>Boats</title>
    <script src="http://code.createjs.com/easeljs-0.7.0.min.js"></script>
    <script src="libs/canvgauge/gauge.js"></script>
    <script src="boat.js"></script>
    <script src="world.js"></script>
    <script src="obstacle.js"></script>
    <script src="checkpoint.js"></script>
    <script src="gauges.js"></script>
    <script>
        var speedGauge;
        var steerGauge;
        var sailGauge;
        var stage;
        var debug;
        var boat;
        var world;
        var keys = {};

        var data = {images: ["assets/rocks.png"],frames: {width:256, height:256},
            animations: {
                rock0:0,
                rock1:5,
                rock2:9
            }
        };

        var spriteSheet = new createjs.SpriteSheet(data);

        function keyDown(event)
        {
            keys[event.keyCode] = true;
        }

        function keyUp(event)
        {
            delete keys[event.keyCode];
        }

        function createObjects()
        {
            world = new World(stage);
            boat = new Boat(stage, world, 150, 150);
            debug = stage.addChild(new createjs.Text("", "16px monospace", "#000"));
            debug.lineHeight = 15;
            debug.textBaseline = "top";
            debug.x = 10;
            debug.y = debug.lineHeight*3-10;
        }

        function tick(event) {
            if(createjs.Ticker.getPaused()) return;
            debug.text = "FPS: " + createjs.Ticker.getMeasuredFPS(createjs.Ticker.getTicks(false)).toFixed(1);
            boat.simulate(event, keys);
            world.simulate(event);
            stage.update(event);
            speedGauge.setValue(boat.speed*4.0); 
            steerGauge.setValue(-boat.rudder_direction);
            sailGauge.setValue(Math.abs(boat.sail_direction-180));
        }
        function init()
        {
            stage = new createjs.Stage("simulationCanvas");
            createObjects();
            createjs.Ticker.on("tick", tick);
            createjs.Ticker.setFPS(45);
            createSpeedGauge();
            createSteerGauge();
            createSailGauge();

            this.document.onkeydown = keyDown;
            this.document.onkeyup = keyUp;  
        }

        function togglePause()
        {
            var paused = !createjs.Ticker.getPaused();
            createjs.Ticker.setPaused(paused);
            document.getElementById("pauseBtn").value = paused ? "Resume simulation" : "Pause simulation";
        }

        function changeWindDirection(direction)
        {
            world.windDirection = direction;
        }

        function changeWindSpeed(speed)
        {
            world.windSpeed = speed
        }

    </script>

 

</head>
<body onload="init(); " bgcolor="#0099CC">
<input type="button" value="Pause simulation" id="pauseBtn" onclick="togglePause();"><br>

<table width="100%">
  <tr>
    <td> 
        <canvas id="simulationCanvas" width="800" height="500">
            alternate content
        </canvas>
    </td>
   <td>
   Direction:<br>
    <input id="slide" type="range" min="0" max="359" step="1" value="180" onchange="changeWindDirection(this.value)"><br>
    Speed:<br>
    <input id="slide" type="range" min="0" max="0.08" step="0.001" value="0.01" onchange="changeWindSpeed(this.value)"><br>
    </td>
    <!--      Speed:<br>
        <input type="text" id="boat_speed"><br>
        Longitudinal force:<br>
        <input type="text" id="longitudinal_force"><br>
        Direction:<br>
        <input type="text" id="boat_direction"><br>
        SailDir:<br>
        <input type="text" id="sail_dir"><br>
        Absolute SailDir:<br>
        <input type="text" id="abs_sail_dir"><br>
        Wind force applied to sail:<br>
        <input type="text" id="wind_force"><br>
        Sail force:<br>
        <input type="text" id="sail_force"><br>
        Sail suction:<br>
        <input type="text" id="sail_suction"><br>          
        RudderDir:<br>
        <input type="text" id="rudder_dir"><br>
        X:<br>
        <input type="text" id="boat_x"><br>
        Y:<br>
        <input type="text" id="boat_y"><br>
        Wind speed:<br>
        <input type="text" id="wind_speed"><br>
        Wind direction:<br>
        <input type="text" id="wind_dir"><br>
        World X:<br>
        <input type="text" id="world_x_shift"><br>
        World Y:<br>
        <input type="text" id="world_y_shift"><br>
    </td> -->
  </tr>
</table>
<canvas id="speedgauge"></canvas>
<canvas id="steergauge"></canvas>
<canvas id="sailgauge"></canvas>
</body>
</html>